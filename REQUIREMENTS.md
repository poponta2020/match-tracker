# 要件定義書：かるたトラッカー Webアプリ公開

作成日: 2026-02-19
ステータス: **確定**

---

## 1. 目的・背景

現在ローカル環境でのみ動作しているかるたトラッカーアプリを、
かるた会のメンバー全員がスマートフォン・PCからインターネット経由でいつでもアクセスできる
Webアプリとして公開する。

---

## 2. 利用者・規模

| 項目 | 内容 |
|------|------|
| 対象ユーザー | かるた会メンバー全員 |
| 想定人数 | 30〜50人以上 |
| 同時アクセス想定 | 練習中に最大10〜20人程度 |
| アカウント配布方法 | 管理者（自分）が全員分作成して配布 |
| 運用管理者 | 自分1人 |

---

## 3. 要求事項

### 3-1. アクセス要件
- インターネット経由でどこからでもアクセスできること
- LAN・VPN等の特別な設定なしにスマートフォンからアクセスできること
- ログインしたメンバーだけがデータを閲覧・操作できること（外部非公開）

### 3-2. 機能要件
現在実装済みの以下の機能をそのまま公開する（追加開発なし）:
- ログイン
- 試合結果の記録・閲覧・統計
- 選手管理（管理者のみ登録・削除）
- 練習日管理・参加登録
- 対戦組み合わせ自動生成・一括入力
- 会場管理

### 3-3. 非機能要件

| 項目 | 要件 |
|------|------|
| セキュリティ | ログインユーザーのみアクセス可能 |
| データ保護 | データが消失しないこと（Render の永続ディスクまたは外部DB） |
| 費用 | 無料プランを最大活用 |
| ドメイン | 不要（サービス提供のURLで可） |
| 可用性 | 実質スリープなし（UptimeRobot で10分おきにping送信して回避） |
| パスワード暗号化 | 後回し（将来対応） |

---

## 4. 確定デプロイ構成

```
[ メンバー（スマホ・PC） ]
        |
        | HTTPS
        v
[ Vercel ] ← React フロントエンド（無料・高速CDN）
        |
        | HTTPS API呼び出し
        v
[ Render（無料プラン） ] ← Spring Boot バックエンド
        |
        | JDBC
        v
[ Render PostgreSQL または Aiven MySQL（無料枠） ] ← データベース

[ UptimeRobot（無料） ] → 10分おきに Render へ ping → スリープ回避
```

### 各サービスの役割

| サービス | 役割 | 費用 |
|----------|------|------|
| **Vercel** | React フロントエンドのホスティング | 無料 |
| **Render** | Spring Boot バックエンドのホスティング | 無料（スリープあり→UptimeRobotで回避） |
| **Render PostgreSQL** または **Aiven MySQL 無料枠** | データベース | 無料 |
| **UptimeRobot** | 10分おきにpingしてRenderのスリープを回避 | 無料 |
| **合計** | | **¥0** |

---

## 5. 実装作業リスト

公開にあたって必要な対応を優先度順にまとめる。

### 【必須】公開前に完了が必要なもの

| # | 作業 | 概要 |
|---|------|------|
| 1 | **DB を MySQL → PostgreSQL に移行**（または MySQL 対応の無料DBに切り替え） | Render の無料 DB は PostgreSQL のみ。Aiven の無料 MySQL を使う場合は現状維持可 |
| 2 | **環境変数の外出し** | DB接続情報・ポート番号などをコードから分離し、環境変数で渡せるようにする |
| 3 | **CORS 設定** | Vercel のURL（`https://xxx.vercel.app`）からのAPIアクセスを許可する |
| 4 | **フロントエンドの API URL 設定** | 本番環境では Render の URL をAPIエンドポイントとして使うよう設定 |
| 5 | **Dockerfile の整備**（バックエンド） | Render へのデプロイに使用 |
| 6 | **Render・Vercel へのデプロイ** | 各サービスにアカウント作成・設定・デプロイ実行 |
| 7 | **UptimeRobot の設定** | Render のヘルスチェックURLを10分おきに監視登録 |

### 【推奨】公開後に対応するもの

| # | 作業 | 概要 |
|---|------|------|
| 8 | **パスワードの BCrypt 暗号化** | 現在は平文保存。公開後でも早めに対応推奨 |
| 9 | **DBバックアップの定期確認** | 定期的に手動エクスポートするなど |

---

## 6. DB選定について（要確認事項）

Render の無料 PostgreSQL は **90日で削除される** という制限があります。
以下から選択が必要です:

| 選択肢 | 費用 | 備考 |
|--------|------|------|
| **Aiven MySQL 無料枠** | 無料 | 現在のコード（MySQL）をそのまま使える。ただし無料枠は小さい |
| **Render PostgreSQL 無料枠** | 無料（90日制限） | Spring Boot 側のDB方言を MySQL → PostgreSQL に変更が必要 |
| **Railway MySQL（無料枠）** | 無料（使用量上限あり） | 別サービスだが MySQL のまま使える |

→ **Aiven MySQL 無料枠を使う** のが現状のコードへの影響が最小。

---

## 7. 進め方（ステップ）

```
Step 1: Aiven / Render / Vercel / UptimeRobot のアカウント作成
Step 2: 環境変数の外出し・CORS設定・フロントURL設定（コード修正）
Step 3: Dockerfile 整備・バックエンドのビルド確認
Step 4: Render にバックエンドをデプロイ
Step 5: Vercel にフロントエンドをデプロイ
Step 6: Aiven MySQL に接続確認・初期データ投入
Step 7: UptimeRobot でスリープ回避設定
Step 8: 動作確認・管理者アカウント作成
Step 9: メンバーへのアカウント作成・URL告知
```

---

## 8. 未対応事項（将来）

- パスワードの BCrypt 暗号化
- 独自ドメインの取得・設定（任意）
- ログ・エラー監視の整備

---

*このドキュメントは認識合わせのベースとして随時更新します。*
