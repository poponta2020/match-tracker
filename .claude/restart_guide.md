# 次のタスク: 試合結果一括入力画面の実装

## 概要
管理者が試合結果を一括で入力できる画面・機能を実装する。個人個人の入力機能は既存のままで、管理者用の一括入力機能を追加する。

## 要件定義

### 最低限の要件
1. **試合ごとの対戦一覧表示**
   - 1試合ごとの対戦が一覧で並んでいる
   - タップすることでどちらが勝ったかを選択できる

2. **枚数差入力**
   - 名前と名前の間に枚数差を入れる
   - スクロール（ドロップダウン）で選択可能

### UI仕様

#### 1. タブによる試合切り替え
- 横スクロール可能なタブバーで試合を切り替え
- 各タブに試合番号と開始時刻を表示
- 選択中のタブは青背景 + 下線で強調
- 入力済みの試合には✓マークを表示

#### 2. 対戦カード表示
```
┌──────────────────────────────────────────┐
│ 選手A名    枚数差選択    選手B名          │
│ (クリック可能)         (クリック可能)     │
│ 🟢がついている方が勝者                    │
└──────────────────────────────────────────┘
```

- **選手名のみ表示**（級位は表示しない）
- 選手名をクリック → その選手を勝者に設定
- 勝者には🟢マークが表示される
- もう一方の選手の🟢マークは自動的に消える

#### 3. 枚数差選択
- ドロップダウンで0〜25枚を選択
- 未選択の場合は「枚数差」と表示

### アクセス方法・権限

#### アクセスポイント
1. **メニューから**
   - ナビゲーションメニューに「📊 試合結果一括入力」を追加
   - 管理者とスーパー管理者のみ表示

2. **ホーム画面から**
   - 今日の対戦がある場合、対戦カードの下に「📝 試合結果一括入力」ボタンを表示
   - 管理者とスーパー管理者のみ表示

#### 権限
- 管理者とスーパー管理者のみアクセス可能

### 保存の仕様

#### 保存タイミング
- 画面下部の「すべて保存」ボタンをクリック
- 変更があった試合のみ保存

#### 枚数差未選択時の挙動
1. 枚数差が未選択の対戦がある場合、警告ダイアログを表示
2. ダイアログ内容:
   ```
   ⚠️ 確認
   以下の対戦で枚数差が未選択です。

   • 第1試合: 高橋三郎 vs 伊藤四郎
   • 第3試合: 佐々木太郎 vs 中村花子

   0枚差として保存しますか？

   [キャンセル]  [0枚差で保存]
   ```
3. ユーザーが「0枚差で保存」を選択した場合のみ保存実行

#### 入力状態の保持
- タブ切り替え時: メモリ上に保持（ページ離脱で消える）
- 保存前にページを離れると入力内容は失われる

#### 保存済み試合の編集
- すでに結果が入力されている試合も通常通り表示
- 編集可能で、保存で上書き
- タブに✓マークを表示して入力済みを示す

### その他の仕様
- 対戦ペアの表示順序: ペアリングAPI登録時の順序のまま
- 保存後も画面に留まり、引き続き編集可能

## 実装範囲

### フロントエンド

#### 新規作成ファイル
1. `karuta-tracker-ui/src/pages/matches/BulkResultInput.jsx`
   - 試合結果一括入力画面のメインコンポーネント

#### 修正ファイル
1. `karuta-tracker-ui/src/components/Layout.jsx`
   - メニューに「試合結果一括入力」を追加
   - 管理者以上のみ表示するよう権限チェック

2. `karuta-tracker-ui/src/pages/Home.jsx`
   - 今日の対戦カードの下に「試合結果一括入力」ボタンを追加
   - 管理者以上のみ表示するよう権限チェック

3. `karuta-tracker-ui/src/App.jsx`
   - `/matches/bulk-input/:sessionId` ルートを追加

### バックエンド
- **既存APIを活用**（新規API作成不要）
  - `GET /api/matches/session/{sessionId}` - 練習セッションの全試合取得
  - `PUT /api/matches/{id}` - 試合結果更新

## 画面イメージ

```
┌─────────────────────────────────────────────────────┐
│ 試合結果一括入力                          [×閉じる]  │
│                                                     │
│ 📅 2025年11月21日 練習                              │
│ 🏛 かるた会館                                        │
├─────────────────────────────────────────────────────┤
│ ┌──┬──┬──┬──┬──┬──┬──┬──┬──┬───┐            │
│ │1試│2試│3試│4試│5試│6試│7試│8試│9試│10試│            │
│ │合✓│合 │合 │合✓│合 │合 │合 │合 │合 │合  │            │
│ │13:│14:│15:│16:│..│..│..│..│..│..  │            │
│ │00 │10 │20 │30 │  │  │  │  │  │    │            │
│ └──┴──┴──┴──┴──┴──┴──┴──┴──┴───┘            │
│   ▲選択中 (青背景 + 下線)                          │
│                                                     │
│   ✓= 結果入力済み                                   │
├─────────────────────────────────────────────────────┤
│                                                     │
│ 第1試合: 13:00-14:10 (8名参加) ✓入力済み            │
│                                                     │
│ ┌─────────────────────────────────────────────┐     │
│ │ 🟢 山田太郎      15枚差 ▼      佐藤花子     │     │
│ │  (クリックで勝利)  ↑         (クリックで勝利)│     │
│ ├─────────────────────────────────────────────┤     │
│ │   田中一郎      10枚差 ▼    🟢 鈴木次郎     │     │
│ ├─────────────────────────────────────────────┤     │
│ │   高橋三郎      枚数差 ▼      伊藤四郎     │     │
│ ├─────────────────────────────────────────────┤     │
│ │   渡辺五郎       5枚差 ▼      木村六子     │     │
│ └─────────────────────────────────────────────┘     │
│                                                     │
│          変更: 0試合                                │
│                                                     │
│ ┌─────────────────────────────────────────────┐     │
│ │              [すべて保存]                   │     │
│ │           (変更がある場合のみ有効)          │     │
│ └─────────────────────────────────────────────┘     │
└─────────────────────────────────────────────────────┘
```

## 実装時の注意点

### UI/UX
- 選手名クリックで勝者切り替えが直感的に動作すること
- タブの横スクロールがスムーズに動作すること
- 変更カウンターで未保存の変更があることをユーザーに明示すること

### データ管理
- タブ切り替え時に入力内容を失わないようメモリ上で管理
- 変更検知ロジックで保存対象を絞り込む
- 枚数差未選択チェックは保存実行前に行う

### エラーハンドリング
- API通信エラー時の適切なエラーメッセージ表示
- 保存失敗時のリトライ機能または明確なエラー通知

### 権限チェック
- コンポーネントレベルでの権限チェック（`isAdmin()` または `isSuperAdmin()`）
- ルートレベルでのアクセス制御

## 次のステップ
実装開始時は、この要件定義を基に以下の順序で進める：
1. BulkResultInput.jsx コンポーネントの作成
2. Layout.jsx と Home.jsx へのボタン追加
3. App.jsx にルート追加
4. 動作確認とテスト
