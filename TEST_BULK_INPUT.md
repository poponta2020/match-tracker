# 試合結果一括入力機能 - テスト手順書

## テスト環境

- バックエンド: http://localhost:8080
- フロントエンド: http://localhost:5173
- テスト日時: 2025-12-04

---

## 前提条件

### 1. 管理者権限のあるユーザーでログイン
- ADMIN または SUPER_ADMIN ロールのユーザーが必要
- 例: 土居悠太（ID=1, role=SUPER_ADMIN）

### 2. テストデータの準備
1. **練習セッション**が登録されていること
   - 練習日、会場、試合数が設定済み

2. **対戦組み合わせ**が作成されていること
   - 練習セッションに対する対戦ペアリングが存在
   - `/pairings` から「対戦組み合わせ生成」で作成可能

---

## テストケース

### TC1: メニューからのアクセス

**手順:**
1. 管理者でログイン
2. ナビゲーションメニューを確認
3. 「試合結果一括入力」メニュー項目があることを確認
4. メニュー項目をクリック

**期待結果:**
- ✅ 管理者のみメニューに「試合結果一括入力」が表示される
- ✅ 一般ユーザー（PLAYER）には表示されない
- ✅ クリックで一括入力画面に遷移

**実際の結果:**
- [ ]

---

### TC2: ホーム画面からのアクセス

**手順:**
1. 今日の日付の対戦組み合わせを作成
2. ホーム画面を開く
3. 「今日の対戦」セクションを確認
4. 「📝 試合結果一括入力」ボタンが表示されることを確認
5. ボタンをクリック

**期待結果:**
- ✅ 今日の対戦がある場合のみボタンが表示される
- ✅ 管理者のみボタンが表示される
- ✅ クリックで一括入力画面に遷移（今日のセッションIDを含む）

**実際の結果:**
- [ ]

---

### TC3: 画面表示の確認

**手順:**
1. 一括入力画面を開く
2. ヘッダー情報を確認
3. タブバーを確認
4. 対戦カードを確認

**期待結果:**
- ✅ ヘッダーに練習日、会場、参加者数が表示される
- ✅ タブバーに全試合が表示される（横スクロール可能）
- ✅ 対戦カードが正しく表示される（選手名、枚数差選択）
- ✅ 入力済みの試合にはタブに✓マークが表示される

**実際の結果:**
- [ ]

---

### TC4: 勝者選択機能

**手順:**
1. 第1試合の対戦カードで選手1をクリック
2. 選手1に🟢マークが表示されることを確認
3. 選手2をクリック
4. 選手2に🟢マークが表示され、選手1の🟢が消えることを確認

**期待結果:**
- ✅ クリックした選手に🟢マークが表示される
- ✅ もう一方の選手の🟢マークは自動的に消える
- ✅ 変更カウンターが増加する

**実際の結果:**
- [ ]

---

### TC5: 枚数差選択機能

**手順:**
1. 枚数差ドロップダウンをクリック
2. 0〜25枚の選択肢が表示されることを確認
3. 15枚を選択
4. 選択値が表示されることを確認

**期待結果:**
- ✅ ドロップダウンに0〜25枚の選択肢が表示される
- ✅ 選択した値が表示される
- ✅ 未選択時は「枚数差」と表示される
- ✅ 変更カウンターが増加する

**実際の結果:**
- [ ]

---

### TC6: タブ切り替え機能

**手順:**
1. 第1試合で勝者と枚数差を入力
2. 第2試合タブをクリック
3. 第2試合の対戦カードが表示されることを確認
4. 第1試合タブに戻る
5. 入力内容が保持されていることを確認

**期待結果:**
- ✅ タブクリックで試合が切り替わる
- ✅ 選択中のタブは青背景＋下線で強調される
- ✅ タブ切り替え時に入力内容が保持される
- ✅ 横スクロールが正常に動作する

**実際の結果:**
- [ ]

---

### TC7: 保存機能（正常系）

**手順:**
1. 第1試合の全対戦で勝者と枚数差を入力
2. 「すべて保存」ボタンをクリック
3. 保存成功メッセージを確認

**期待結果:**
- ✅ 保存成功のアラートが表示される
- ✅ 変更カウンターが0にリセットされる
- ✅ タブに✓マークが表示される
- ✅ 試合結果が正しくデータベースに保存される

**実際の結果:**
- [ ]

---

### TC8: 枚数差未選択時の警告

**手順:**
1. 第1試合で勝者のみ選択（枚数差は未選択）
2. 「すべて保存」ボタンをクリック
3. 警告ダイアログが表示されることを確認
4. 「キャンセル」をクリック
5. 保存されないことを確認

**手順（続き）:**
1. 再度「すべて保存」ボタンをクリック
2. 警告ダイアログで「0枚差で保存」をクリック
3. 保存されることを確認

**期待結果:**
- ✅ 枚数差未選択の警告ダイアログが表示される
- ✅ ダイアログに未選択の対戦リストが表示される
- ✅ 「キャンセル」で保存がキャンセルされる
- ✅ 「0枚差で保存」で0枚として保存される

**実際の結果:**
- [ ]

---

### TC9: 既存データの編集

**手順:**
1. すでに結果が入力されている試合を開く
2. タブに✓マークが表示されることを確認
3. 勝者を変更
4. 枚数差を変更
5. 保存

**期待結果:**
- ✅ 既存データが正しく表示される
- ✅ 入力済み試合のタブに✓マークが表示される
- ✅ 編集可能
- ✅ 保存で上書きされる

**実際の結果:**
- [ ]

---

### TC10: 権限チェック

**手順:**
1. 一般ユーザー（PLAYER）でログイン
2. URLを直接入力: `/matches/bulk-input/1`
3. アクセスが拒否されることを確認

**期待結果:**
- ✅ 一般ユーザーはアクセスできない
- ✅ ホーム画面にリダイレクトされる
- ✅ アラートメッセージが表示される

**実際の結果:**
- [ ]

---

### TC11: 変更カウンター

**手順:**
1. 第1試合の対戦1で勝者を選択
2. 変更カウンターが「1試合」になることを確認
3. 対戦2で勝者を選択
4. 変更カウンターが「2試合」になることを確認
5. 保存
6. 変更カウンターが「0試合」にリセットされることを確認

**期待結果:**
- ✅ 変更した対戦の数が正しくカウントされる
- ✅ 保存後に0にリセットされる

**実際の結果:**
- [ ]

---

### TC12: エラーハンドリング

**手順:**
1. バックエンドを停止
2. 一括入力画面を開く
3. エラーメッセージが表示されることを確認

**期待結果:**
- ✅ データ取得失敗時にエラーメッセージが表示される
- ✅ ユーザーにわかりやすいエラー内容が表示される
- ✅ ホームに戻るボタンが表示される

**実際の結果:**
- [ ]

---

## 確認事項チェックリスト

### UI/UX
- [ ] レスポンシブデザインが正常に動作する（スマホ表示）
- [ ] タブの横スクロールがスムーズに動作する
- [ ] 選手名クリックで勝者切り替えが直感的に動作する
- [ ] 変更カウンターで未保存の変更が明示される

### データ整合性
- [ ] 保存したデータがデータベースに正しく記録される
- [ ] 既存データの更新が正しく動作する
- [ ] 枚数差0枚が正しく保存される
- [ ] 複数試合の一括保存が正しく動作する

### パフォーマンス
- [ ] データ取得が3秒以内に完了する
- [ ] 保存処理が5秒以内に完了する
- [ ] タブ切り替えが即座に反応する

### セキュリティ
- [ ] 管理者以外はアクセスできない
- [ ] URLを直接入力してもアクセス制御が働く
- [ ] CSRF対策が有効（既存の実装に依存）

---

## バグ報告テンプレート

**発見日時:**

**テストケース番号:**

**再現手順:**
1.
2.
3.

**期待される動作:**

**実際の動作:**

**エラーメッセージ:**

**スクリーンショット:**

**環境:**
- OS:
- ブラウザ:
- ユーザーロール:

---

## テスト完了確認

- [ ] すべてのテストケースを実行した
- [ ] バグが発見された場合は報告した
- [ ] 主要な動作フローが正常に動作することを確認した
- [ ] 管理者・一般ユーザー両方でテストした
- [ ] スマホ表示でもテストした

**テスト実施者:**

**テスト完了日時:**

**総合評価:**
- [ ] 本番リリース可能
- [ ] 軽微な修正が必要
- [ ] 重大なバグあり、リリース不可

**備考:**
