# 作業履歴

このファイルには、プロジェクトの作業履歴を時系列で記録します。

## 2025-11-06 - 設計レビューと改善実施

### 設計レビュー
- DESIGN_DOCUMENT.mdの包括的レビュー実施
- プロのアプリケーション作成者の観点から修正点・改善点を抽出
- ユーザーとの詳細な要件確認と決定事項の記録

### 主要な設計変更
1. **技術スタック更新**
   - Java: 25.0.1 → 21 LTS（現在利用可能な最新LTS）
   - デプロイ先: Railway/Render → AWS（EC2 + RDS または Lightsail）
   - 外部API追加: Anthropic Claude API（AI分析機能）

2. **認証・権限管理の統一**
   - スーパー管理者と選手の認証を統一（選手名 + パスワード）
   - 3段階のロールベース権限管理を実装
     - SUPER_ADMIN（最上位管理者）: 全機能
     - ADMIN（管理者）: 練習日管理、組み合わせ作成、基本機能
     - PLAYER（一般選手）: 基本機能のみ
   - セッションタイムアウト: 48時間
   - パスワードポリシー: なし（ユーザー体験優先）

3. **データベース設計の改善**
   - `super_admins`テーブルを廃止
   - `players`テーブルに追加:
     - `role` ENUM('SUPER_ADMIN', 'ADMIN', 'PLAYER')
     - `deleted_at` TIMESTAMP（論理削除対応）
   - 新規テーブル追加: `ai_usage_logs`（AI分析使用記録）
   - インデックスの最適化
     - players: idx_name_active, idx_deleted_at
     - player_profiles: idx_valid_to
     - matches: idx_matches_date, idx_matches_date_player1/2, idx_matches_winner
     - practice_sessions: idx_session_date
     - match_participations: idx_participations_session_player
   - テーブル数: 7テーブル（構成変更）

4. **画面設計の簡素化**
   - 判定画面（10. 結果入力画面）を廃止
   - 認証画面を統一（ロール別にメニュー表示を変更）
   - 画面数: 17画面 → 16画面
   - エラー画面を追加（HTTPステータスコード、エラーメッセージ、スタックトレース表示）

5. **AI分析機能の詳細化**
   - Anthropic Claude API使用
   - レート制限: アプリ全体で月100回まで
   - 毎月1日0時にカウンターリセット
   - 月次使用回数のみ記録（個別リクエスト履歴は保存しない）

6. **待機者機能の追加**
   - 対戦組み合わせ作成時に待機者を手動/自動で設定可能
   - 奇数人数時の自動待機者決定機能
   - ローテーション機能は実装しない

### 非機能要件の明確化
- **パフォーマンス**: 応答時間目標3秒以内（基準値、超過してもエラーにしない）
- **ログ管理**: SLF4J + Logback、保持期間30日
- **データ保持**: 対戦データ永久保持、バックアップは初期段階では考慮しない
- **タイムゾーン**: 日本時間（JST）のみ
- **多言語対応**: なし
- **アクセシビリティ**: 考慮しない

### 段階的リリース計画の策定
**Phase 1: MVP（Minimum Viable Product）**
- 認証、選手管理、練習日管理、対戦結果入力、基本成績表示
- データベース: players, player_profiles, matches, practice_sessions

**Phase 2: 成績分析機能強化**
- 年別・月別タブ、グラフ表示、級別・対戦相手別成績テーブル
- 参加予定管理
- データベース: match_participations追加

**Phase 3: 自動化機能**
- 対戦組み合わせ自動生成、待機者設定
- 事前組み合わせ表示
- データベース: match_pairings追加

**Phase 4: AI分析機能**
- Claude API連携、レート制限実装
- データベース: ai_usage_logs追加

### ドキュメント更新
- `DESIGN_DOCUMENT.md`を全面改訂
  - 最終更新日: 2025-11-06
  - レビュー実施日: 2025-11-06
  - 段階的リリース計画を追加
- `DESIGN_REVIEW_DECISIONS.md`を新規作成
  - 設計レビューの決定事項を詳細に記録
  - データベーススキーマ変更サマリー
  - 次のステップの明記

### その他の決定事項
- AWS料金: 無料枠利用で12ヶ月無料、以降月$10-15程度（月500円以内は困難）
- AI API予算: 月$3程度（約450円）、月100回制限
- データ量見積: 週3回×4試合×20人 = 年間約12,000レコード
- 画面遷移の可視化と整理（ユーザーからの質問対応）

### 次のステップ
- Phase 1（MVP）の詳細設計
- 実装開始準備

## 2025-11-05 - アプリケーション設計の完了

### 要件定義・設計
- プロジェクト要件の整理と確認
  - 競技かるた練習結果管理アプリの基本コンセプト確定
  - 4つの主要画面構成を決定（対戦結果入力、日付別一覧、対戦詳細、個人成績）
  - 技術スタック決定：Spring Boot + Thymeleaf + MySQL

### データベース設計
- 7テーブルの設計完了
  1. players（選手マスタ）
  2. player_profiles（選手情報履歴）- 級・段位の変更履歴管理
  3. matches（対戦結果）- 作成者・更新者の記録
  4. super_admins（スーパー管理者）
  5. practice_sessions（練習日情報）
  6. match_participations（選手の参加予定）
  7. match_pairings（対戦組み合わせ）★新規追加
- ER図の作成
- インデックス設計とパフォーマンス最適化の検討

### 画面設計
- 17画面の詳細設計完了
  - スーパー管理者用：4画面
  - 一般ユーザー用：13画面
- 画面遷移図の作成
- UI/UX仕様の決定
  - レスポンシブデザイン（スマホ対応）
  - Select2による検索可能なセレクトボックス
  - Chart.jsによる勝率推移グラフ

### 個人成績機能の詳細設計
- 総合/年別/月別のタブ切り替え機能
- 基本成績、級別成績、対戦相手別成績の表示
- ソート機能付きテーブル
- 勝率推移グラフ（年別・月別）
- AI分析機能（自然言語での質問対応）

### 対戦組み合わせ自動生成機能の設計★新規
- 自動マッチングアルゴリズムの設計
  - 対戦履歴を考慮（過去30日間、直近ほど重視）
  - 同日の別試合で既に対戦した相手は除外
  - パフォーマンス最適化（2回のDBクエリのみ、推定応答時間50-100ms）
- 手動調整機能（セレクトボックスで入れ替え・追加・削除）
- 組み合わせの保存と対戦結果入力時の参照機能

### ドキュメント作成
- `DESIGN_DOCUMENT.md`の作成
  - プロジェクト概要
  - 技術スタック
  - 機能要件（8項目）
  - 画面一覧と遷移図
  - データベース設計（7テーブル詳細）
  - 画面詳細仕様
  - パフォーマンス・セキュリティに関する補足事項

### その他
- `.gitignore`の文字化け修正
- `paper.txt`で要件の整理

## 2025-10-30 08:04 - プロジェクト初期セットアップ

- Gitリポジトリを初期化
- `.gitignore`ファイルを作成（node_modules、venv、ビルド成果物、環境変数、IDE設定などを除外）
- `README.md`ファイルを作成（プロジェクトの説明、機能、セットアップ手順のテンプレート）
- GitHubリポジトリ（match-tracker）と接続
- ローカルとリモートのマージコンフリクトを解決（`.gitignore`ファイル）
- 初回コミットをGitHubにプッシュ完了
- 作業履歴ファイル（`CHANGELOG.md`）を作成
